<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Eighties box</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="{{ url_for('static', filename='main.css') }}"
    />
    <script src="{{ url_for('static', filename='dropzone.js') }}"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css"
      type="text/css"
    />
    <script src="{{ url_for('static', filename='socket.io.min.js') }}"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='simplekeyboard.css') }}"
    />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='cookieconsent.css') }}">

    <script src="{{ url_for('static', filename='phaser.js') }}"></script>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
    <script src="{{ url_for('static', filename='client.js') }}"></script>
    <script src="{{ url_for('static', filename='simplekeyboard.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      var buildNumber = new Date().getTime();
      var chosen_bbs = "";
    </script>

    <!--<script src="./static/bassoontracker/src/host.js"></script>
    <script src="./static/bassoontracker/hosts/AmiBase/amibase.js"></script>
    <script src="./static/bassoontracker/hosts/AmiBase/bridge.js"></script>

    <script src="./static/bassoontracker/src/enum.js"></script>
    <script src="./static/bassoontracker/src/eventBus.js"></script>
    <script src="./static/bassoontracker/src/filesystem.js"></script>
    <script src="./static/bassoontracker/src/audio.js"></script>

    <script src="./static/bassoontracker/src/models/note.js"></script>
    <script src="./static/bassoontracker/src/models/instrument.js"></script>
    <script src="./static/bassoontracker/src/models/sample.js"></script>

    <script src="./static/bassoontracker/src/lib/util.js"></script>
    <script src="./static/bassoontracker/src/lib/waaclock.js"></script>
    <script src="./static/bassoontracker/src/lib/filesaver.js"></script>
    <script src="./static/bassoontracker/src/lib/audioBufferToWav.js"></script>
    <script src="./static/bassoontracker/src/lib/dropbox.js"></script>

    <script src="./static/bassoontracker/src/audio/getSamplerate.js"></script>
    <script src="./static/bassoontracker/src/audio/raw.js"></script>
    <script src="./static/bassoontracker/src/audio/8svx.js"></script>
    <script src="./static/bassoontracker/src/audio/riffWave.js"></script>
    <script src="./static/bassoontracker/src/audio/detectSampleType.js"></script>
    <script src="./static/bassoontracker/src/audio/filterChain.js"></script>
    <script src="./static/bassoontracker/src/audio/midi.js"></script>

    <script src="./static/bassoontracker/src/main.js"></script>
    <script src="./static/bassoontracker/src/app.js"></script>
    <script src="./static/bassoontracker/src/tracker.js"></script>
    <script src="./static/bassoontracker/src/editor.js"></script>
    <script src="./static/bassoontracker/src/preloader.js"></script>
    <script src="./static/bassoontracker/src/fetchService.js"></script>
    <script src="./static/bassoontracker/src/storage.js"></script>
    <script src="./static/bassoontracker/src/settings.js"></script>
    <script src="./static/bassoontracker/src/log.js"></script>

    <script src="./static/bassoontracker/src/ui/app/layout.js"></script>

    <script src="./static/bassoontracker/src/ui/yascal/yascal.js"></script>
    <script src="./static/bassoontracker/src/ui/yascal/sprite.js"></script>

    <script src="./static/bassoontracker/src/ui/main.js"></script>
    <script src="./static/bassoontracker/src/ui/assets.js"></script>
    <script src="./static/bassoontracker/src/ui/input.js"></script>
    <script src="./static/bassoontracker/src/ui/ticker.js"></script>
    <script src="./static/bassoontracker/src/ui/stateManager.js"></script>

    <script src="./static/bassoontracker/src/ui/components/element.js"></script>
    <script src="./static/bassoontracker/src/ui/components/panel.js"></script>
    <script src="./static/bassoontracker/src/ui/components/image.js"></script>
    <script src="./static/bassoontracker/src/ui/components/button.js"></script>
    <script src="./static/bassoontracker/src/ui/components/checkboxbutton.js"></script>
    <script src="./static/bassoontracker/src/ui/components/label.js"></script>
    <script src="./static/bassoontracker/src/ui/components/inputbox.js"></script>
    <script src="./static/bassoontracker/src/ui/components/listbox.js"></script>
    <script src="./static/bassoontracker/src/ui/components/radiogroup.js"></script>
    <script src="./static/bassoontracker/src/ui/components/checkbox.js"></script>
    <script src="./static/bassoontracker/src/ui/components/numberdisplay.js"></script>
    <script src="./static/bassoontracker/src/ui/components/modalDialog.js"></script>
    <script src="./static/bassoontracker/src/ui/components/scale9.js"></script>
    <script src="./static/bassoontracker/src/ui/components/bitmapfont.js"></script>
    <script src="./static/bassoontracker/src/ui/components/knob.js"></script>
    <script src="./static/bassoontracker/src/ui/components/rangeSlider.js"></script>
    <script src="./static/bassoontracker/src/ui/components/menu.js"></script>
    <script src="./static/bassoontracker/src/ui/components/submenu.js"></script>
    <script src="./static/bassoontracker/src/ui/components/animsprite.js"></script>

    <script src="./static/bassoontracker/src/ui/app/components/songPatternList.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/patternSidebar.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/appSidebar.js"></script>

    <script src="./static/bassoontracker/src/ui/app/panelContainer.js"></script>
    <script src="./static/bassoontracker/src/ui/app/menu.js"></script>
    <script src="./static/bassoontracker/src/ui/app/mainPanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/controlPanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/patternPanel.js"></script>

    <script src="./static/bassoontracker/src/ui/mainPanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/patternView.js"></script>
    <script src="./static/bassoontracker/src/ui/fxpanel.js"></script>
    <script src="./static/bassoontracker/src/ui/sampleView.js"></script>
    <script src="./static/bassoontracker/src/ui/diskOperations.js"></script>
    <script src="./static/bassoontracker/src/ui/diskOp_Actions.js"></script>
    <script src="./static/bassoontracker/src/ui/diskOp_Type.js"></script>
    <script src="./static/bassoontracker/src/ui/diskOp_Targets.js"></script>
    <script src="./static/bassoontracker/src/ui/diskOp_Save.js"></script>
    <script src="./static/bassoontracker/src/ui/optionsPanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/pianoView.js"></script>
    <script src="./static/bassoontracker/src/ui/waveform.js"></script>
    <script src="./static/bassoontracker/src/ui/envelope.js"></script>
    <script src="./static/bassoontracker/src/ui/envelopePanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/visualiser.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/vumeter.js"></script>
    <script src="./static/bassoontracker/src/ui/spinBox.js"></script>
    <script src="./static/bassoontracker/src/ui/sliderBox.js"></script>
    <script src="./static/bassoontracker/src/ui/editPanel.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/songControl.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/trackControl.js"></script>
    <script src="./static/bassoontracker/src/ui/app/components/buttonGroup.js"></script>
    <script src="./static/bassoontracker/src/ui/infopanel.js"></script>

    <script src="./static/bassoontracker/src/provider/modarchive.js"></script>
    <script src="./static/bassoontracker/src/provider/modulespl.js"></script>
    <script src="./static/bassoontracker/src/provider/dropbox.js"></script>
    <script src="./static/bassoontracker/src/provider/bassoon.js"></script>

    <script src="./static/bassoontracker/src/fileformats/detect.js"></script>
    <script src="./static/bassoontracker/src/fileformats/protracker.js"></script>
    <script src="./static/bassoontracker/src/fileformats/soundtracker.js"></script>
    <script src="./static/bassoontracker/src/fileformats/fasttracker.js"></script>

    <script src="./static/bassoontracker/src/lib/zip.js"></script>

    <script src="./static/bassoontracker/plugins/loader.js"></script>-->

    <script src="./static/bundle.js"></script>

    <style>
       #input-container {
            display: flex;
            padding: 10px;
            background-color: #333;
        }
      canvas {
        touch-action: auto;
      }
      #game-container {
  display: flex;
  justify-content: center;
  width: 100%; /* Adjust as needed */
}
      .spinner {
        margin: 100px auto;
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 2s linear infinite, resize 3s ease-in-out infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes resize {
        0%,
        100% {
          width: 10px;
          height: 10px;
        }
        50% {
          width: 170px;
          height: 170px;
        }
      }

     

      .spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000; /* Make sure this is above everything else */
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body onload="processQueue();document.getElementById('terminal-input').focus();">
    <style>
      html,
      body {
        height: 100%;

      }
      body {
        background-color: black;
        margin: 0;
        padding: 0;
      }

      canvas {
        margin: auto;
        display: block;
        cursor: url(/static/bassontracker/amiga_cursor.png), auto;
      }
      canvas:focus {
        outline: none;
      }

      .message {
        font-family: sans-serif;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        min-height: 30px;
        padding: 20px;
        background-color: rgba(243, 33, 70, 0.5);
        color: rgba(255, 255, 255, 0.8);
        text-align: center;
      }

      .message a {
        color: white;
      }

      .message button {
        padding: 10px 20px;
        border-radius: 10px;
      }
    </style>

    <!-- Tracker stuff-->
    <canvas
      id="canvas"
      class="tracker"
      style="display: none"
      tabindex="1"
      moz-opaque
    ></canvas>

    <!-- TODO: https://www.shadertoy.com/view/Ms23DR -->

    <!-- https://greggman.github.io/pico-8-post-processing/nano-villager_html/?filter=Old+TV+effect -->

    <!-- 8< -- ## GL SHADER STUFF STARTS HERE ## -- -->

    <!-- vertex shader -->
    <script id="some-vertex-shader" type="x-shader/x-vertex">
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      varying   vec2 v_texCoord;
      void main()
      {
        gl_Position = vec4(a_position.x, a_position.y, 0, 1);
        v_texCoord = a_texCoord;
      }
    </script>

    <!-- fragment shader -->
    <script id="some-fragment-shader" type="x-shader/x-fragment">

      precision mediump float;

      varying vec2		v_texCoord;
      uniform vec2		u_canvasSize;
      uniform sampler2D	u_texture;

      // PUBLIC DOMAIN CRT STYLED SCAN-LINE SHADER
      //   by Timothy Lottes
      // https://www.shadertoy.com/view/XsjSzR
      //   modified (borked) by ultrabrite

      // Emulated input resolution.
      const vec2 texSize=vec2(1200.0,600.0);

      // Hardness of scanline.
      //  -8.0 = soft
      // -16.0 = medium
      float hardScan=-8.0;

      // Hardness of pixels in scanline.
      // -2.0 = soft
      // -4.0 = hard
      const float hardPix=-2.0;

      // Hardness of shadow mask in scanline.
      // 0.5 = hard
      // 3.0 = soft
      const float hardMask=2.0;

      const vec3 compos = vec3(1.0/6.0,1.0/2.0,5.0/6.0);

      // Display warp.
      // 0.0 = none
      // 1.0/8.0 = extreme
      const vec2 warp=vec2(1.0/24.0,1.0/24.0);

      //------------------------------------------------------------------------

      // Nearest emulated sample given floating point position and texel offset.
      // Also zero's off screen.
      vec3 Fetch(vec2 pos,vec2 off)
      {
        pos=floor(pos * texSize + off) / texSize;
        if (pos.x<0.0 || pos.x>=1.0 || pos.y<0.0 || pos.y>=1.0)
          return vec3(0.0,0.0,0.0);
        return texture2D(u_texture,pos.xy).rgb;
      }

      // Distance in emulated pixels to nearest texel.
      vec2 Dist(vec2 pos)
      {
        pos=pos * texSize;
        return -((pos-floor(pos))-vec2(0.5));
      }

      // 1D Gaussian.
      float Gaus(float pos,float scale)
      {
        return exp2(scale*pos*pos);
      }

      // 3-tap Gaussian filter along horz line.
      vec3 Horz3(vec2 pos,float off)
      {
        mat3 m=mat3(Fetch(pos,vec2(-1.0,off)),
              Fetch(pos,vec2( 0.0,off)),
              Fetch(pos,vec2( 1.0,off)));
        float dst=Dist(pos).x;
        // Convert distance to weight.
        vec3 v=vec3(Gaus(dst-1.0,hardPix),
              Gaus(dst+0.0,hardPix),
              Gaus(dst+1.0,hardPix));
          // Return filtered sample.
          return (m*v)/(v.x+v.y+v.z);
      }

      // 5-tap Gaussian filter along horz line.
      vec3 Horz5(vec2 pos,float off)
      {
        vec3 a=Fetch(pos,vec2(-2.0,off));
        vec3 b=Fetch(pos,vec2(-1.0,off));
        vec3 c=Fetch(pos,vec2( 0.0,off));
        vec3 d=Fetch(pos,vec2( 1.0,off));
        vec3 e=Fetch(pos,vec2( 2.0,off));
        float dstx=Dist(pos).x;
        // Convert distance to weight.
        float wa=Gaus(dstx-2.0,hardPix);
        float wb=Gaus(dstx-1.0,hardPix);
        float wc=Gaus(dstx+0.0,hardPix);
        float wd=Gaus(dstx+1.0,hardPix);
        float we=Gaus(dstx+2.0,hardPix);
        // Return filtered sample.
        return (a*wa+b*wb+c*wc+d*wd+e*we)/(wa+wb+wc+wd+we);
      }

      // Allow nearest three lines to effect pixel.
      vec3 Tri(vec2 pos)
      {
        mat3 m=mat3(Horz3(pos,-1.0),
              Horz5(pos, 0.0),
              Horz3(pos, 1.0));
        float dsty=Dist(pos).y;
        vec3 v=vec3(Gaus(dsty-1.0,hardScan),
              Gaus(dsty+0.0,hardScan),
              Gaus(dsty+1.0,hardScan));
        return m*v;
      }

      // Distortion of scanlines, and end of screen alpha.
      vec2 Warp(vec2 pos)
      {
        pos=pos*2.0-1.0;
        pos*=1.0+vec2(pos.y*pos.y,pos.x*pos.x)*warp;
        return pos*0.5+0.5;
      }

      vec3 Mask(float x)
      {
        vec3 v  = clamp((fract(x)-compos)*hardMask,-1.0/3.0,1.0/3.0);
        return 2.0/3.0+abs(v);
      }

      void main()
      {
        gl_FragColor.rgb = Tri(Warp(v_texCoord.xy))*Mask(v_texCoord.x*texSize.x);
        gl_FragColor.a = 1.0;
      }
    </script>

    <script type="text/javascript">
      function crt() {
        p8Canvas = document.getElementById("canvas");
        canvas = p8Canvas.cloneNode(true);

        p8Canvas.name = "p8Canvas";
        canvas.name = "canvas";
        canvas.id = "canvas_clone";
        canvas.class = "";
        canvas.width = p8Canvas.clientWidth;
        canvas.height = p8Canvas.clientHeight;
        gl = canvas.getContext("webgl");

        function switchEffect() {
          console.error("switchEffect");
          if (p8Canvas.parentNode != null) {
            p8Canvas.parentNode.insertBefore(canvas, p8Canvas);
            canvas.parentNode.removeChild(p8Canvas);
          } else {
            canvas.parentNode.insertBefore(p8Canvas, canvas);
            p8Canvas.parentNode.removeChild(canvas);
          }
        }

        function onKeyDown_switch(event) {
          event = event || window.event;
          var o = document.activeElement;
          if (!o || o == document.body || o.tagName.toLowerCase() == "canvas") {
            console.error("rr");
            if ([16].indexOf(event.keyCode) > -1) {
              switchEffect();
            }
          }
        }
        window.addEventListener("keydown", onKeyDown_switch, false);

        if (gl) {
          switchEffect();

          function glresize() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;

            gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
            gl.uniform2f(
              gl.getUniformLocation(program, "u_canvasSize"),
              gl.canvas.width,
              gl.canvas.height
            );
          }

          window.addEventListener("load", glresize, false);
          window.addEventListener("resize", glresize, false);
          window.addEventListener("orientationchange", glresize, false);
          window.addEventListener("fullscreenchange", glresize, false);
          window.addEventListener("webkitfullscreenchange", glresize, false); //for itch.app

          function compileShader(gl, source, type) {
            var shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
              var info = gl.getShaderInfoLog(shader);
              throw "could not compile shader:" + info;
            }
            return shader;
          }

          var vs_script = document.getElementById("some-vertex-shader");
          var vs = compileShader(gl, vs_script.text, gl.VERTEX_SHADER);
          var fs_script = document.getElementById("some-fragment-shader");
          var fs = compileShader(gl, fs_script.text, gl.FRAGMENT_SHADER);

          program = gl.createProgram();
          gl.attachShader(program, vs);
          gl.attachShader(program, fs);
          gl.linkProgram(program);
          if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            var info = gl.getProgramInfoLog(program);
            throw "shader program failed to link:" + info;
          }
          gl.useProgram(program);

          gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
          gl.uniform3f(
            gl.getUniformLocation(program, "u_canvasSize"),
            gl.canvas.width,
            gl.canvas.height,
            0.0
          );

          var texCoordLocation = gl.getAttribLocation(program, "a_texCoord");
          gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
          gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array([1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0]),
            gl.STATIC_DRAW
          );
          gl.enableVertexAttribArray(texCoordLocation);
          gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 0, 0);

          var positionLocation = gl.getAttribLocation(program, "a_position");
          gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
          gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array([1, 1, -1, 1, -1, -1, -1, -1, 1, -1, 1, 1]),
            gl.STATIC_DRAW
          );
          gl.enableVertexAttribArray(positionLocation);
          gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

          function gldraw() {
            gl.texImage2D(
              gl.TEXTURE_2D,
              0,
              gl.RGBA,
              gl.RGBA,
              gl.UNSIGNED_BYTE,
              p8Canvas
            );
            gl.drawArrays(gl.TRIANGLES, 0, 6);
            requestAnimationFrame(gldraw);
          }

          function draw() {
            gltex = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, gltex);
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_S,
              gl.MIRRORED_REPEAT
            );
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_T,
              gl.MIRRORED_REPEAT
            );
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
            gl.activeTexture(gl.TEXTURE0);
            gl.uniform1i(gl.getUniformLocation(program, "u_texture0"), 0);
            gldraw();
          }
          window.addEventListener("load", draw, false);
          draw();

          window.d = draw;
        }
      }

      function updateInputField(key) {
          const inputField = document.getElementById('terminal-input');
          
          if (key === 'Backspace') {
              inputField.value = inputField.value.slice(0, -1);
          } else if (key.length === 1) {
              inputField.value += key;
          }
          // For special keys like arrows, we don't modify the input field
      }

    </script>
    <!-- Tracker stuff end ## -- -->

    <div id="loadingSpinner" class="spinner-overlay" style="display: none">
      <div class="spinner"></div>
    </div>
    <div id="fileUploadDiv" style="display: none">
      <button id="toggleButtonFile">Close upload area</button>
      <div id="uploadStatusFile"></div>
      <form
        action="/upload"
        class="dropzone"
        id="uploadFormFile"
        enctype="multipart/form-data"
      >
        <div class="fallback">
          <input name="file" type="file" />
          <button type="submit">Upload</button>
        </div>
      </form>
    </div>
    <div id="ANSIUploadDiv" style="display: none">
      <button id="toggleButtonANSI">Close ANSI Upload</button>
      <div id="uploadStatusANSI" style="color:grey"></div>
      <form
        action="/upload"
        class="dropzone"
        id="uploadFormANSI"
        enctype="multipart/form-data"
      >
        <div class="fallback">
          <input name="file" type="file" />
          <button type="submit">Upload</button>
        </div>
      </form>
    </div>
    <div id="game-container"></div>
    <div id="input-container">
      <label for="terminal-input" id="input-label" class="sr-only">Enter command:</label>
      <input type="text" id="terminal-input" onkeyup="this.value = '';" aria-describedby="input-label" placeholder="Enter command">
      <button id="submit-btn" onclick="document.getElementById('terminal-input').value='';emitKeyPress('Enter');">Submit</button>
    </div>
    <div class="spinner" id="spinner"></div>
    <div
      class="simple-keyboard"
      id="simple-keyboard"
      style="display: none"
    ></div>
    <script>
      const Keyboard = window.SimpleKeyboard.default;
      var uploadToken = "";
      var uploadID = "";
      var current_file_area = "";

      const myKeyboard = new Keyboard({
        layout: {
          default: [
            "^ 1 2 3 4 5 6 7 8 9 0 - = {bksp}",
            "{tab} q w e r t y u i o p ] [ \\",
            "{lock} a s d f g h j k l {arrowup} ' {enter}",
            "{shift} z x c v b n m {arrowleft} {arrowright} . {shift}",
            "{escape} @ {arrowdown} {space}",
          ],
          shift: [
            "~ ! @ # $ % ; & * ( ) _ + {bksp}",
            "{tab} Q W E R T Y U I O P { } |",
            '{lock} A S D F G H J K L : " {enter}',
            "{shift} Z X C V B N M , / ? {shift}",
            "< > {escape} @ {space}",
          ],
        },
        onKeyPress: (button) => onKeyPress(button),
      });

      function onKeyPress(button) {
        if (button === "{shift}" || button === "{lock}") handleShift();

        const buttonMap = {
          "{tab}": "Tab",
          "{bksp}": "Backspace",
          "{enter}": "Enter",
          "{space}": " ",
          "{escape}": "Escape",
          "{arrowdown}": "ArrowDown",
          "{arrowup}": "ArrowUp",
          "{arrowleft}": "ArrowLeft",
          "{arrowright}": "ArrowRight",
        };
        var readableButton = buttonMap[button] || button;
        handleKeyCode(readableButton);
      }

      function handleShift() {
        const currentLayout = myKeyboard.options.layoutName;
        const shiftToggle = currentLayout === "default" ? "shift" : "default";

        myKeyboard.setOptions({
          layoutName: shiftToggle,
        });
      }

      function generateUUID() {
        return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
          (
            c ^
            (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
          ).toString(16)
        );
      }

      function addClickListeners() {
        const toggleButtonFile = document.getElementById("toggleButtonFile");
        const fileUploadDiv = document.getElementById("fileUploadDiv");

        toggleButtonFile.addEventListener("click", function () {
          socket.emit("upload_finished", {});
          fileUploadDiv.style.display = "none";
          const canvasElements = document.getElementsByTagName("canvas");
          for (let i = 0; i < canvasElements.length; i++) {
            if (canvasElements[i].className != "tracker") {
              canvasElements[i].style.display = "inline";
            }
          }
        });
        const toggleButtonANSI = document.getElementById("toggleButtonANSI");
        const ANSIUploadDiv = document.getElementById("ANSIUploadDiv");

        toggleButtonANSI.addEventListener("click", function () {
          ANSIUploadDiv.style.display = "none";
          socket.emit("ansi_upload_finished", { type: toggleButtonANSI.innerHTML });
          const canvasElements = document.getElementsByTagName("canvas");
          for (let i = 0; i < canvasElements.length; i++) {
            if (canvasElements[i].className != "tracker") {
              canvasElements[i].style.display = "inline";
            }
          }
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
       addClickListeners();
      });

    </script>
    <script src="{{ url_for('static', filename='cookieconsent.js') }}"></script>
    <script src="{{ url_for('static', filename='cookieconsent-config.js') }}"></script>
    <script src="{{ url_for('static', filename='uploads.js') }}"></script>
    
  </body>
</html>
